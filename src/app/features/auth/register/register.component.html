<div class="auth-container">
    <div class="auth-card">
        <!-- Header -->
        <div class="auth-header">
            <div class="logo-section">
                <div class="logo-icon">üè¶</div>
                <h1 class="logo-title">{{ APP_NAME }}</h1>
                <p class="auth-subtitle">Secure Trade Finance Platform</p>
            </div>
        </div>

        <!-- Registration Success State -->
        <div *ngIf="registrationSuccess" class="success-state">
            <div class="success-icon">‚úÖ</div>
            <h2 class="success-title">Registration Successful!</h2>
            <p class="success-message">Welcome to BlockTrade. Redirecting you to the dashboard...</p>
            <div class="loading-spinner">
                <div class="spinner"></div>
                <span>Redirecting...</span>
            </div>
        </div>

        <!-- Registration Form -->
        <div *ngIf="!registrationSuccess" class="registration-form">
            <!-- Progress Indicator -->
            <div class="progress-indicator">
                <div class="progress-steps">
                    <div *ngFor="let title of stepTitles; let i = index" class="progress-step"
                        [class.active]="i === currentStep" [class.completed]="i < currentStep">
                        <div class="step-number">{{ i + 1 }}</div>
                        <div class="step-title">{{ title }}</div>
                    </div>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" [style.width.%]="((currentStep + 1) / stepTitles.length) * 100"></div>
                </div>
            </div>

            <!-- Error Display -->
            <div *ngIf="apiErrors.length > 0" class="error-section">
                <div class="error-icon">‚ö†Ô∏è</div>
                <div class="error-content">
                    <strong>Registration Error</strong>
                    <ul class="error-list">
                        <li *ngFor="let error of apiErrors">{{ error }}</li>
                    </ul>
                </div>
            </div>

            <!-- Form Steps -->
            <form class="registration-steps" (ngSubmit)="onSubmit()">

                <!-- Step 1: Personal Information -->
                <div *ngIf="currentStep === 0" class="form-step">
                    <h3 class="step-header">Personal Information</h3>
                    <div [formGroup]="personalInfoForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label" for="firstName">First Name *</label>
                                <input type="text" id="firstName" class="form-input" formControlName="firstName"
                                    placeholder="Enter your first name"
                                    [class.error]="getFieldError(personalInfoForm, 'firstName')">
                                <div *ngIf="getFieldError(personalInfoForm, 'firstName')" class="error-message">
                                    {{ getFieldError(personalInfoForm, 'firstName') }}
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="form-label" for="lastName">Last Name *</label>
                                <input type="text" id="lastName" class="form-input" formControlName="lastName"
                                    placeholder="Enter your last name"
                                    [class.error]="getFieldError(personalInfoForm, 'lastName')">
                                <div *ngIf="getFieldError(personalInfoForm, 'lastName')" class="error-message">
                                    {{ getFieldError(personalInfoForm, 'lastName') }}
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="email">Email Address *</label>
                            <input type="email" id="email" class="form-input" formControlName="email"
                                placeholder="Enter your email address"
                                [class.error]="getFieldError(personalInfoForm, 'email')">
                            <div *ngIf="getFieldError(personalInfoForm, 'email')" class="error-message">
                                {{ getFieldError(personalInfoForm, 'email') }}
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="phone">Phone Number *</label>
                            <input type="tel" id="phone" class="form-input" formControlName="phone"
                                placeholder="Enter your phone number"
                                [class.error]="getFieldError(personalInfoForm, 'phone')">
                            <div *ngIf="getFieldError(personalInfoForm, 'phone')" class="error-message">
                                {{ getFieldError(personalInfoForm, 'phone') }}
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Step 2: Organization Details -->
                <div *ngIf="currentStep === 1" class="form-step">
                    <h3 class="step-header">Organization Details</h3>
                    <div [formGroup]="organizationForm">
                        <div class="form-group">
                            <label class="form-label" for="organizationName">Organization Name *</label>
                            <input type="text" id="organizationName" class="form-input"
                                formControlName="organizationName" placeholder="Enter your organization name"
                                [class.error]="getFieldError(organizationForm, 'organizationName')">
                            <div *ngIf="getFieldError(organizationForm, 'organizationName')" class="error-message">
                                {{ getFieldError(organizationForm, 'organizationName') }}
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label" for="organizationType">Organization Type *</label>
                                <select id="organizationType" class="form-input" formControlName="organizationType"
                                    [class.error]="getFieldError(organizationForm, 'organizationType')">
                                    <option value="">Select organization type</option>
                                    <option *ngFor="let type of organizationTypes" [value]="type.value">
                                        {{ type.label }}
                                    </option>
                                </select>
                                <div *ngIf="getFieldError(organizationForm, 'organizationType')" class="error-message">
                                    {{ getFieldError(organizationForm, 'organizationType') }}
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="form-label" for="organizationId">Organization ID</label>
                                <input type="text" id="organizationId" class="form-input"
                                    formControlName="organizationId"
                                    placeholder="Optional - for existing organizations">
                            </div>
                        </div>

                        <!-- Address Section -->
                        <div class="address-section">
                            <h4 class="section-title">Organization Address</h4>
                            <div formGroupName="address">
                                <div class="form-group">
                                    <label class="form-label" for="street">Street Address *</label>
                                    <input type="text" id="street" class="form-input" formControlName="street"
                                        placeholder="Enter street address"
                                        [class.error]="getNestedFieldError('address.street')">
                                    <div *ngIf="getNestedFieldError('address.street')" class="error-message">
                                        {{ getNestedFieldError('address.street') }}
                                    </div>
                                </div>

                                <div class="form-row">
                                    <div class="form-group">
                                        <label class="form-label" for="city">City *</label>
                                        <input type="text" id="city" class="form-input" formControlName="city"
                                            placeholder="Enter city"
                                            [class.error]="getNestedFieldError('address.city')">
                                        <div *ngIf="getNestedFieldError('address.city')" class="error-message">
                                            {{ getNestedFieldError('address.city') }}
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label" for="state">State *</label>
                                        <input type="text" id="state" class="form-input" formControlName="state"
                                            placeholder="Enter state"
                                            [class.error]="getNestedFieldError('address.state')">
                                        <div *ngIf="getNestedFieldError('address.state')" class="error-message">
                                            {{ getNestedFieldError('address.state') }}
                                        </div>
                                    </div>
                                </div>

                                <div class="form-row">
                                    <div class="form-group">
                                        <label class="form-label" for="country">Country *</label>
                                        <input type="text" id="country" class="form-input" formControlName="country"
                                            placeholder="Enter country"
                                            [class.error]="getNestedFieldError('address.country')">
                                        <div *ngIf="getNestedFieldError('address.country')" class="error-message">
                                            {{ getNestedFieldError('address.country') }}
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label" for="postalCode">Postal Code *</label>
                                        <input type="text" id="postalCode" class="form-input"
                                            formControlName="postalCode" placeholder="Enter postal code"
                                            [class.error]="getNestedFieldError('address.postalCode')">
                                        <div *ngIf="getNestedFieldError('address.postalCode')" class="error-message">
                                            {{ getNestedFieldError('address.postalCode') }}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Step 3: Security Setup -->
                <div *ngIf="currentStep === 2" class="form-step">
                    <h3 class="step-header">Security Setup</h3>
                    <div [formGroup]="securityForm">
                        <div class="form-group">
                            <label class="form-label" for="username">Username *</label>
                            <input type="text" id="username" class="form-input" formControlName="username"
                                placeholder="Choose a username" [class.error]="getFieldError(securityForm, 'username')">
                            <div *ngIf="getFieldError(securityForm, 'username')" class="error-message">
                                {{ getFieldError(securityForm, 'username') }}
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="password">Password *</label>
                            <div class="password-input-container">
                                <input [type]="hidePassword ? 'password' : 'text'" id="password" class="form-input"
                                    formControlName="password" placeholder="Create a strong password"
                                    [class.error]="getFieldError(securityForm, 'password')">
                                <button type="button" class="password-toggle" (click)="togglePasswordVisibility()">
                                    {{ hidePassword ? 'üëÅÔ∏è' : 'üôà' }}
                                </button>
                            </div>
                            <div *ngIf="getFieldError(securityForm, 'password')" class="error-message">
                                {{ getFieldError(securityForm, 'password') }}
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="confirmPassword">Confirm Password *</label>
                            <div class="password-input-container">
                                <input [type]="hideConfirmPassword ? 'password' : 'text'" id="confirmPassword"
                                    class="form-input" formControlName="confirmPassword"
                                    placeholder="Confirm your password"
                                    [class.error]="getFieldError(securityForm, 'confirmPassword') || passwordMismatchError">
                                <button type="button" class="password-toggle"
                                    (click)="toggleConfirmPasswordVisibility()">
                                    {{ hideConfirmPassword ? 'üëÅÔ∏è' : 'üôà' }}
                                </button>
                            </div>
                            <div *ngIf="getFieldError(securityForm, 'confirmPassword')" class="error-message">
                                {{ getFieldError(securityForm, 'confirmPassword') }}
                            </div>
                            <div *ngIf="passwordMismatchError" class="error-message">
                                {{ passwordMismatchError }}
                            </div>
                        </div>

                        <div class="form-group">
                            <div class="checkbox-container">
                                <input type="checkbox" id="acceptTerms" formControlName="acceptTerms">
                                <label for="acceptTerms">
                                    I accept the <a href="/terms" class="link">Terms and Conditions</a> and
                                    <a href="/privacy" class="link">Privacy Policy</a> *
                                </label>
                            </div>
                            <div *ngIf="getFieldError(securityForm, 'acceptTerms')" class="error-message">
                                {{ getFieldError(securityForm, 'acceptTerms') }}
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Navigation Buttons -->
                <div class="form-navigation">
                    <button *ngIf="currentStep > 0" type="button" class="btn btn-secondary" (click)="previousStep()">
                        Previous
                    </button>

                    <button *ngIf="currentStep < stepTitles.length - 1" type="button" class="btn btn-primary"
                        [disabled]="!canProceedToNext" (click)="nextStep()">
                        Next
                    </button>

                    <button *ngIf="currentStep === stepTitles.length - 1" type="submit" class="btn btn-primary"
                        [disabled]="!canSubmit">
                        <span *ngIf="!isLoading">Create Account</span>
                        <div *ngIf="isLoading" class="loading-spinner">
                            <div class="spinner"></div>
                            <span>Creating Account...</span>
                        </div>
                    </button>
                </div>
            </form>
        </div>

        <!-- Footer -->
        <div class="auth-footer">
            <p>Already have an account?
                <a (click)="onBackToLogin()" class="auth-link">Sign In</a>
            </p>
        </div>
    </div>
</div>